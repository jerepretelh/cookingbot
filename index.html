<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Chef Bot Pro - Safari Edition</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
    <script src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/canvas-confetti@1.6.0/dist/confetti.browser.min.js"></script>
    <style>
        body { 
            background-color: black; 
            margin: 0; 
            overflow: hidden; 
            color: white; 
            -webkit-tap-highlight-color: transparent;
            font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Helvetica, Arial, sans-serif;
        }
        .progress-ring { 
            transition: stroke-dashoffset 16ms linear; 
            will-change: stroke-dashoffset;
        }
        @keyframes pulse-soft {
            0%, 100% { opacity: 1; }
            50% { opacity: 0.4; }
        }
        .animate-pulse-soft { animation: pulse-soft 2s infinite; }
        
        input::-webkit-outer-spin-button,
        input::-webkit-inner-spin-button {
            -webkit-appearance: none;
            margin: 0;
        }
    </style>
</head>
<body>
    <div id="root"></div>

    <script type="text/babel">
        const { useState, useEffect, useRef, useCallback } = React;

        // Iconos SVG corregidos para evitar deformaciones y errores de sintaxis
        const SVGIcon = ({ name, size = 24, className = "", fill = "none" }) => {
            const icons = {
                ChefHat: (
                    <g strokeWidth="2" stroke="currentColor" fill={fill}>
                        <path d="M6 14v5a2 2 0 0 0 2 2h8a2 2 0 0 0 2-2v-5" />
                        <path d="M18 10a4 4 0 0 0-8 0 4 4 0 0 0-8 0 2 2 0 0 0 2 2 4 4 0 0 0 8 0 4 4 0 0 0 8 0 2 2 0 0 0 2-2z" />
                    </g>
                ),
                Volume2: (
                    <>
                        <path d="M11 5L6 9H2v6h4l5 4V5z" />
                        <path d="M15.54 8.46a5 5 0 0 1 0 7.07M19.07 4.93a10 10 0 0 1 0 14.14" />
                    </>
                ),
                VolumeX: (
                    <>
                        <path d="M11 5L6 9H2v6h4l5 4V5z" />
                        <path d="M23 9l-6 6M17 9l6 6" />
                    </>
                ),
                Sliders: (
                    <>
                        <path d="M4 21v-7M4 10V3M12 21v-9M12 8V3M20 21v-5M20 12V3M1 14h6M9 8h6M17 16h6" />
                    </>
                ),
                X: <path d="M18 6L6 18M6 6l12 12" />,
                Play: <path d="m7 4 12 8-12 8V4z" />,
                Pause: (
                    <>
                        <path d="M6 4h4v16H6z" />
                        <path d="M14 4h4v16h-4z" />
                    </>
                ),
                Hand: <path d="M18 11V6a2 2 0 0 0-2-2v0a2 2 0 0 0-2 2v0M14 10V4a2 2 0 0 0-2-2v0a2 2 0 0 0-2 2v11M10 10.5V6a2 2 0 0 0-2-2v0a2 2 0 0 0-2 2v8M18 8a2 2 0 1 1 4 0v6a8 8 0 0 1-8 8h-2c-2.8 0-4.5-.86-5.99-2.34l-3.6-3.6a2 2 0 0 1 2.83-2.82L7 15" />,
                Timer: (
                    <>
                        <path d="M10 2h4" />
                        <path d="M12 14l3-3" />
                        <circle cx="12" cy="14" r="8" />
                    </>
                ),
                Clock: (
                    <>
                        <circle cx="12" cy="12" r="10" />
                        <path d="M12 6v6l4 2" />
                    </>
                )
            };

            return (
                <svg 
                    viewBox="0 0 24 24" 
                    width={size} 
                    height={size} 
                    fill={fill === "currentColor" ? "currentColor" : "none"} 
                    stroke="currentColor" 
                    strokeWidth="2.5" 
                    strokeLinecap="round" 
                    strokeLinejoin="round" 
                    className={className}
                >
                    {icons[name] || null}
                </svg>
            );
        };

        const App = () => {
            const [config, setConfig] = useState({
                ingredient: "Huevo",
                prepTime: 10,
                cycles: 3,
                transitionTime: 5, 
                steps: [
                    { id: 1, name: "COCINAR LADO A", duration: 30, hex: "#52c18d" },
                    { id: 2, name: "COCINAR LADO B", duration: 20, hex: "#f97316" }
                ]
            });

            const [isRunning, setIsRunning] = useState(false);
            const [isMuted, setIsMuted] = useState(false);
            const [currentCycle, setCurrentCycle] = useState(0); 
            const [currentStepIndex, setCurrentStepIndex] = useState(-1); 
            const [timeLeft, setTimeLeft] = useState(config.prepTime);
            const [isSettingsOpen, setIsSettingsOpen] = useState(false);
            const [showOverlay, setShowOverlay] = useState(false);
            const [overlayMessage, setOverlayMessage] = useState("");
            const [isManualWait, setIsManualWait] = useState(false);

            const requestRef = useRef();
            const previousTimeRef = useRef();

            const launchConfetti = () => {
                if (window.confetti) {
                    window.confetti({
                        particleCount: 150,
                        spread: 70,
                        origin: { y: 0.6 },
                        colors: ['#3b82f6', '#52c18d', '#f97316', '#ffffff']
                    });
                }
            };

            const speakLocal = useCallback((text) => {
                if (isMuted || !window.speechSynthesis) return;
                window.speechSynthesis.cancel();
                const utterance = new SpeechSynthesisUtterance(text);
                utterance.lang = 'es-ES';
                utterance.rate = 1.1;
                window.speechSynthesis.speak(utterance);
            }, [isMuted]);

            const animate = useCallback((time) => {
                if (previousTimeRef.current !== undefined) {
                    const deltaTime = (time - previousTimeRef.current) / 1000;
                    if (isRunning && !showOverlay) {
                        setTimeLeft(prev => {
                            const next = prev - deltaTime;
                            return next <= 0 ? 0 : next;
                        });
                    }
                }
                previousTimeRef.current = time;
                requestRef.current = requestAnimationFrame(animate);
            }, [isRunning, showOverlay]);

            useEffect(() => {
                requestRef.current = requestAnimationFrame(animate);
                return () => cancelAnimationFrame(requestRef.current);
            }, [animate]);

            useEffect(() => {
                if (timeLeft <= 0 && isRunning && !showOverlay) {
                    handleStepEnd();
                }
            }, [timeLeft, isRunning, showOverlay]);

            const handleStepEnd = () => {
                const ing = config.ingredient;
                if (currentCycle === 0) {
                    triggerOverlay(`¡Aceite listo! Pon el ${ing} ahora.`, true, () => {
                        setCurrentCycle(1); setCurrentStepIndex(0); setTimeLeft(config.steps[0].duration);
                    });
                } else if (currentStepIndex === -2) {
                    triggerOverlay(`Sartén lista. ¡Pon el siguiente ${ing}!`, true, () => {
                        setCurrentStepIndex(0); setTimeLeft(config.steps[0].duration);
                    });
                } else if (currentStepIndex < config.steps.length - 1) {
                    const nextIdx = currentStepIndex + 1;
                    triggerOverlay(`¡Voltea el ${ing}!`, false, () => {
                        setCurrentStepIndex(nextIdx); setTimeLeft(config.steps[nextIdx].duration);
                    });
                } else if (currentCycle < config.cycles) {
                    triggerOverlay(`${ing} terminado. Retíralo.`, true, () => {
                        setCurrentCycle(c => c + 1); setCurrentStepIndex(-2); setTimeLeft(config.transitionTime);
                    });
                } else {
                    setIsRunning(false);
                    launchConfetti();
                    triggerOverlay("¡Cocina completada!", true, () => resetTimer());
                }
            };

            const triggerOverlay = (msg, manual, callback) => {
                setOverlayMessage(msg);
                setIsManualWait(manual);
                setShowOverlay(true);
                speakLocal(msg);
                window._callback = callback;
                if (!manual) setTimeout(proceed, 3500);
            };

            const proceed = () => {
                setShowOverlay(false);
                if (window._callback) {
                    window._callback();
                    window._callback = null;
                }
            };

            const resetTimer = () => {
                setIsRunning(false); setCurrentCycle(0); setCurrentStepIndex(-1);
                setTimeLeft(config.prepTime); setShowOverlay(false);
            };

            const theme = (() => {
                if (currentStepIndex === -1) return { label: "CALENTANDO ACEITE", color: "#3b82f6" };
                if (currentStepIndex === -2) return { label: "ESPERANDO UNIDAD", color: "#a855f7" };
                return { label: config.steps[currentStepIndex].name, color: config.steps[currentStepIndex].hex };
            })();

            const maxTime = currentStepIndex === -1 ? config.prepTime : (currentStepIndex === -2 ? config.transitionTime : config.steps[currentStepIndex].duration);
            const radius = 42;
            const circ = 2 * Math.PI * radius;
            const offset = circ - (timeLeft / maxTime) * circ;

            return (
                <div className="h-screen bg-black text-white flex flex-col font-sans select-none relative overflow-hidden">
                    {/* Header */}
                    <header className="px-6 pt-8 pb-4 flex justify-between items-start z-10">
                        <div className="flex items-center gap-3">
                            <div className="w-10 h-10 bg-blue-600 rounded-2xl flex items-center justify-center shadow-[0_0_20px_rgba(37,99,235,0.4)]">
                                <SVGIcon name="ChefHat" size={20} className="text-white" fill="currentColor" />
                            </div>
                            <div>
                                <h1 className="text-xs font-black uppercase tracking-tight italic leading-none">Chef Bot <span className="text-blue-500">PRO</span></h1>
                                <p className="text-[7px] font-bold text-zinc-500 uppercase tracking-widest mt-1">Sincronizado</p>
                            </div>
                        </div>
                        
                        <div className="flex gap-2">
                            <button onClick={() => setIsMuted(!isMuted)} className="w-11 h-11 bg-zinc-900/80 backdrop-blur rounded-2xl flex items-center justify-center border border-white/5 active:scale-95 transition-transform">
                                <SVGIcon name={isMuted ? "VolumeX" : "Volume2"} size={18} className={isMuted ? "text-red-500" : "text-zinc-400"} />
                            </button>
                            <button onClick={() => setIsSettingsOpen(true)} className="w-11 h-11 bg-zinc-900/80 backdrop-blur rounded-2xl flex items-center justify-center border border-white/5 active:scale-95 transition-transform">
                                <SVGIcon name="Sliders" size={18} className="text-zinc-400" />
                            </button>
                        </div>
                    </header>

                    {/* Progress Dots */}
                    <div className="flex justify-center gap-2 mb-4">
                        {[...Array(config.cycles)].map((_, i) => (
                            <div key={i} className={`h-1 rounded-full transition-all duration-700 ${i < currentCycle - 1 ? 'w-4 bg-blue-500' : i === (currentCycle > 0 ? currentCycle - 1 : 0) && currentCycle > 0 ? 'w-10 bg-white shadow-[0_0_10px_white]' : 'w-4 bg-zinc-800'}`} />
                        ))}
                    </div>

                    <main className="flex-1 flex flex-col items-center justify-center px-6">
                        <div className="relative w-full aspect-square max-w-[340px] flex items-center justify-center">
                            <svg viewBox="0 0 100 100" className="w-full h-full -rotate-90">
                                <circle cx="50" cy="50" r={radius} stroke="rgba(255,255,255,0.06)" strokeWidth="4.5" fill="none" />
                                <circle 
                                    cx="50" cy="50" r={radius} 
                                    stroke={theme.color} 
                                    strokeWidth="5" 
                                    fill="none" 
                                    strokeDasharray={circ} 
                                    strokeDashoffset={isNaN(offset) ? circ : offset} 
                                    strokeLinecap="round"
                                    className="progress-ring"
                                />
                            </svg>
                            <div className="absolute inset-0 flex flex-col items-center justify-center">
                                <span className="text-[120px] font-black italic tracking-tighter tabular-nums leading-none">
                                    {Math.ceil(timeLeft)}
                                </span>
                                <div className="mt-2 flex flex-col items-center gap-1">
                                    <div className="flex items-center gap-2">
                                        <div className="w-1.5 h-1.5 rounded-full animate-pulse-soft" style={{backgroundColor: theme.color}}></div>
                                        <span className="text-[11px] font-black uppercase tracking-[0.25em]" style={{color: theme.color}}>{theme.label}</span>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <div className="mt-16 w-full max-w-xs flex flex-col items-center space-y-6">
                            <button 
                                onClick={() => {
                                    if (!isRunning && currentCycle === 0) speakLocal(`Iniciando cocina de ${config.ingredient}`);
                                    setIsRunning(!isRunning);
                                }}
                                className="w-[200px] h-[68px] bg-white text-black rounded-full flex items-center justify-center gap-3 shadow-[0_20px_40px_rgba(255,255,255,0.15)] active:scale-95 transition-all"
                            >
                                <SVGIcon name={isRunning ? "Pause" : "Play"} size={24} fill="currentColor" />
                                <span className="text-base font-black uppercase tracking-widest leading-none">{isRunning ? "PAUSAR" : "INICIAR"}</span>
                            </button>
                            <button onClick={resetTimer} className="text-[10px] font-bold uppercase tracking-[0.4em] text-zinc-600 hover:text-white transition-colors">Reiniciar Sesión</button>
                        </div>
                    </main>

                    {/* Overlay */}
                    {showOverlay && (
                        <div className={`fixed inset-0 z-50 flex flex-col items-center justify-center p-8 text-center backdrop-blur-2xl ${isManualWait ? 'bg-blue-600/95' : 'bg-orange-600/95'}`}>
                            <div className="w-24 h-24 mb-10 bg-white/20 rounded-[40px] flex items-center justify-center animate-bounce shadow-2xl">
                                <SVGIcon name={isManualWait ? "Hand" : "Timer"} size={48} className="text-white" />
                            </div>
                            <h2 className="text-5xl font-black italic mb-12 leading-tight uppercase tracking-tighter">{overlayMessage}</h2>
                            {isManualWait && (
                                <button onClick={proceed} className="bg-white text-black w-full max-w-[220px] py-6 rounded-full text-xl font-black uppercase active:scale-90 transition-transform shadow-2xl">LISTO</button>
                            )}
                        </div>
                    )}

                    {/* Settings Estilo iOS */}
                    {isSettingsOpen && (
                        <div className="fixed inset-0 z-[100] bg-black p-8 flex flex-col">
                            <div className="flex justify-between items-center mb-10">
                                <h2 className="text-3xl font-black italic uppercase">Configuración</h2>
                                <button onClick={() => setIsSettingsOpen(false)} className="w-12 h-12 bg-zinc-900 rounded-2xl flex items-center justify-center border border-white/5">
                                    <SVGIcon name="X" size={24} className="text-white" />
                                </button>
                            </div>
                            
                            <div className="space-y-6 overflow-y-auto flex-1 pb-10">
                                <div className="bg-zinc-900/40 p-6 rounded-[32px] border border-white/5">
                                    <label className="text-[9px] font-black text-zinc-500 uppercase tracking-widest mb-3 block">PRODUCTO PRINCIPAL</label>
                                    <input type="text" value={config.ingredient} onChange={e => setConfig({...config, ingredient: e.target.value})} className="bg-transparent text-2xl font-black w-full outline-none uppercase text-blue-500" />
                                </div>

                                <div className="space-y-3">
                                    {[
                                        { label: "UNIDADES A COCINAR", key: "cycles", value: config.cycles },
                                        { label: "TIEMPO DE PRE-CALENTADO", key: "prepTime", value: config.prepTime },
                                        ...config.steps.map((s, i) => ({ label: s.name, key: `step-${i}`, value: s.duration, isStep: true, index: i }))
                                    ].map((item, idx) => (
                                        <div key={idx} className="bg-zinc-900/40 px-6 py-5 rounded-[32px] border border-white/5 flex items-center justify-between">
                                            <span className="text-[10px] font-black uppercase tracking-wider text-zinc-400">{item.label}</span>
                                            <div className="flex items-center gap-4 bg-zinc-800/30 p-2 rounded-full border border-white/5">
                                                <button 
                                                    onClick={() => {
                                                        if (item.isStep) {
                                                            const s = [...config.steps];
                                                            s[item.index].duration = Math.max(1, s[item.index].duration - 1);
                                                            setConfig({...config, steps: s});
                                                        } else {
                                                            setConfig({...config, [item.key]: Math.max(1, item.value - 1)});
                                                        }
                                                    }}
                                                    className="w-8 h-8 bg-white text-black rounded-full flex items-center justify-center font-bold text-xl active:scale-90"
                                                >—</button>
                                                <span className="w-6 text-center font-black text-lg">{item.value}</span>
                                                <button 
                                                    onClick={() => {
                                                        if (item.isStep) {
                                                            const s = [...config.steps];
                                                            s[item.index].duration++;
                                                            setConfig({...config, steps: s});
                                                        } else {
                                                            setConfig({...config, [item.key]: item.value + 1});
                                                        }
                                                    }}
                                                    className="w-8 h-8 bg-white text-black rounded-full flex items-center justify-center font-bold text-xl active:scale-90"
                                                >+</button>
                                            </div>
                                        </div>
                                    ))}
                                </div>
                            </div>
                            
                            <button onClick={() => {setIsSettingsOpen(false); resetTimer();}} className="w-full mt-4 py-6 bg-blue-600 rounded-[32px] font-black uppercase tracking-widest text-sm shadow-xl shadow-blue-500/20">APLICAR CAMBIOS</button>
                        </div>
                    )}
                </div>
            );
        };

        const root = ReactDOM.createRoot(document.getElementById('root'));
        root.render(<App />);
    </script>
</body>
</html>
